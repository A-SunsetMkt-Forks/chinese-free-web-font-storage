---
title: 【工具设计】cn-font-split 的运行原理
description:
article:
    authors:
        - 江夏尧
    section: 技术内幕
    tags:
        - 设计流程
    pubDate: 2023-7-16
    image: ''
---

# 【工具设计】cn-font-split 的运行原理

cn-font-split 是中文网字计划的字体打包插件，能够运行在 Nodejs、Deno、浏览器中，帮助开发者打包字体文件。

## 打包字体文件的流程

打包字体文件在 cn-font-split 中主要分为下面几个步骤

1. 读取字体文件二进制，字体文件主要类型为主流的 otf 或者 ttf 字体文件。其它类型的字体将会转化为 otf 类型进行操作。
2. 解析字体的基础信息，包括字体的名称、大小、授权信息等
3. 收集字体中的字形编码信息和字形特性的映射关系。
4. 根据上一步的信息进行预分包（PreSubset），这一步为数据结构表示，尚未进行字体的分包。
5. 根据预分包信息进行分包构建，构建完成之后的字体分包为 otf 类型。
6. 通过多线程模式将 otf 二进制发送至 woff2 压缩线程，进行格式转换
7. 收集打包过程中的所有进程信息，生成 css 文件、报告文件等信息
