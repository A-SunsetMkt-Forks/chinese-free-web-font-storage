---
import Layout from '../../../Layout/Layout.astro';
import type { FontReporter } from '../../../components/fonts/utils';
import { FontDetails } from '../../../page/FontDetails';
import data from '../../../../index.json';
export function getStaticPaths() {
    return Object.entries(data).flatMap(([key, val]) => {
        return val.remotePath.map((remote) => {
            const [_, name] = remote.match(/dist\/(.*?)\/result/)!;
            return { params: { font: key, name } };
        });
    });
}
const { font, version, name } = Astro.params;
const fileName = name!
    .replaceAll(' ', '_')
    // 更换文件夹中的 . 为 _
    .replace(/(?<=\/.*)\.(?=.*\/)/g, '_');
const reporter = await fetch(
    `https://ik.imagekit.io/chinesefonts/packages/${font}/dist/${fileName}/reporter.json`
).then<FontReporter>((res) => res.json());
const style = `font-family:'${reporter.message.fontFamily}';font-weight:'${reporter.message.fontSubFamily}'`;
---

<Layout
    canonicalURL={`/fonts/${font}`}
    defaultFontCSS={`https://ik.imagekit.io/chinesefonts/packages/${font}/dist/${fileName}/result.css`}
    title={name}
    style={style}
    image={`https://ik.imagekit.io/chinesefonts/packages/${font}/dist/${fileName}/preview.png`}
>
    <section>
        <!-- TODO: 尝试静态化 -->
        <!-- TODO: 添加展示徽标 -->
        <FontDetails
            reporter={reporter}
            packageName={font!}
            version={version!}
            cnName={name!}
            subName={name!}
            client:load
        />
    </section>
</Layout>
